<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>surgeRy: basic landmark data generation example explained â€¢ surgeRy</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="surgeRy: basic landmark data generation example explained">
<meta property="og:description" content="surgeRy">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">surgeRy</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/surgeRy.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/surgeRygen.html">surgeRy: basic landmark data generation example explained</a>
    </li>
    <li>
      <a href="../articles/surgeRytrain.html">surgeRy: basic landmark unet training example explained</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stnava/surgeRy/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>surgeRy: basic landmark data generation example explained</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/stnava/surgeRy/blob/master/vignettes/surgeRygen.Rmd"><code>vignettes/surgeRygen.Rmd</code></a></small>
      <div class="hidden name"><code>surgeRygen.Rmd</code></div>

    </div>

    
    
<div id="overview-of-surgery" class="section level1">
<h1 class="hasAnchor">
<a href="#overview-of-surgery" class="anchor"></a>Overview of <code>surgeRy</code>
</h1>
<p>We overview landmark-specific training although the approach is very similar for segmentations or segmentations and landmarks.</p>
<p>the augmentation strategy will use:</p>
<ul>
<li><p>geometric transformation of images (rigid, affine, etc)</p></li>
<li><p>gaussian noise</p></li>
<li><p>simulated bias field</p></li>
<li><p>histogram warping</p></li>
</ul>
<p>to create new versions of images and points from an input image list. Points are in physical space.</p>
<div id="setting-up-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-up-the-data" class="anchor"></a>Setting up the data</h2>
<p><strong>This will be run on a separate thread (or <code>R</code> session) from the <code>surgeRyLMtrain.Rmd</code> code.</strong> Environment variables control multi-threading for CPU in ANTs and tensorflow. See below for how to set these at the beginning on an experiment. We set the number of threads to 12 below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span><span class="st">"TF_NUM_INTEROP_THREADS"</span><span class="op">=</span><span class="fl">12</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span><span class="st">"TF_NUM_INTRAOP_THREADS"</span><span class="op">=</span><span class="fl">12</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span><span class="st">"ITK_GLOBAL_DEFAULT_NUMBER_OF_THREADS"</span><span class="op">=</span><span class="fl">12</span><span class="op">)</span></code></pre></div>
<p>See the code below for how to assemble the images and points for augmentation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># record the GPU</span>
<span class="va">gpuid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"CUDA_VISIBLE_DEVICES"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span> <span class="va">ANTsR</span> <span class="op">)</span>
<span class="co">#&gt; Loading required package: ANTsRCore</span>
<span class="co">#&gt; ANTsRCore 0.7.5</span>
<span class="co">#&gt; For reproducible results, please set the environment variable ANTS_RANDOM_SEED,</span>
<span class="co">#&gt; either in .Renviron or with a seed (e.g. XXX): </span>
<span class="co">#&gt; Sys.setenv(ANTS_RANDOM_SEED = XXX)</span>
<span class="co">#&gt; Sys.setenv(ITK_GLOBAL_DEFAULT_NUMBER_OF_THREADS = 1)</span>
<span class="co">#&gt; may also be required for reproducible results. See</span>
<span class="co">#&gt; https://github.com/ANTsX/ANTs/wiki/antsRegistration-reproducibility-issues</span>
<span class="co">#&gt; for more information</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'ANTsRCore'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     sd, var</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     all, any, apply, max, min, prod, range, sum</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span> <span class="va"><a href="https://github.com/ANTsX/ANTsRNet">ANTsRNet</a></span> <span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span> <span class="va"><a href="https://github.com/rstudio/tensorflow">tensorflow</a></span> <span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span> <span class="va"><a href="https://keras.rstudio.com">keras</a></span> <span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span> <span class="va"><a href="https://github.com/rstudio/tfdatasets">tfdatasets</a></span> <span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span> <span class="va"><a href="https://github.com/rstudio/reticulate">reticulate</a></span> <span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span> <span class="va">patchMatchR</span> <span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'patchMatchR'</span>
<span class="co">#&gt; The following objects are masked from 'package:ANTsRNet':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     MSE, PSNR, SSIM</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span> <span class="va"><a href="https://github.com/stnava/surgeRy">surgeRy</a></span> <span class="op">)</span>
<span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/import.html">import</a></span><span class="op">(</span><span class="st">"numpy"</span><span class="op">)</span>
<span class="va">mytype</span> <span class="op">=</span> <span class="st">"float32"</span>
<span class="va">downsam</span> <span class="op">=</span> <span class="fl">4</span>   <span class="co"># downsamples images</span>
<span class="co"># collect your images - a list of lists - multiple entries in each list are fine</span>
<span class="va">rids</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span> <span class="va">x</span>, <span class="va">downsammer</span><span class="op">=</span><span class="fl">4</span> <span class="op">)</span> <span class="op">{</span>
  <span class="va">img</span> <span class="op">=</span> <span class="fu">ri</span><span class="op">(</span> <span class="va">x</span> <span class="op">)</span>
  <span class="fu">resampleImage</span><span class="op">(</span> <span class="va">img</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span><span class="op">/</span><span class="va">downsammer</span>, useVoxels<span class="op">=</span><span class="cn">TRUE</span> <span class="op">)</span>
<span class="op">}</span>
<span class="va">upperhalf</span> <span class="op">=</span> <span class="fu">rids</span><span class="op">(</span> <span class="fl">1</span> <span class="op">)</span> <span class="op">*</span> <span class="fl">0</span> <span class="op">+</span> <span class="fl">1</span> <span class="co"># this just gives us more segmentation labels</span>
<span class="va">upperhalf</span><span class="op">[</span><span class="fl">33</span><span class="op">:</span><span class="fl">64</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">32</span><span class="op">]</span> <span class="op">=</span> <span class="fl">2</span>
<span class="va">upperhalf</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">32</span>,<span class="fl">33</span><span class="op">:</span><span class="fl">64</span><span class="op">]</span> <span class="op">=</span> <span class="fl">3</span>
<span class="va">upperhalf</span><span class="op">[</span><span class="fl">33</span><span class="op">:</span><span class="fl">64</span>,<span class="fl">33</span><span class="op">:</span><span class="fl">64</span><span class="op">]</span> <span class="op">=</span> <span class="fl">4</span>
<span class="va">ilist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="fu">rids</span><span class="op">(</span> <span class="fl">1</span> <span class="op">)</span>, <span class="fu">getMask</span><span class="op">(</span> <span class="fu">rids</span><span class="op">(</span> <span class="fl">1</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="fu">rids</span><span class="op">(</span> <span class="fl">2</span> <span class="op">)</span>, <span class="fu">getMask</span><span class="op">(</span> <span class="fu">rids</span><span class="op">(</span> <span class="fl">2</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="fu">rids</span><span class="op">(</span> <span class="fl">3</span> <span class="op">)</span>, <span class="fu">getMask</span><span class="op">(</span> <span class="fu">rids</span><span class="op">(</span> <span class="fl">3</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="fu">rids</span><span class="op">(</span> <span class="fl">4</span> <span class="op">)</span>, <span class="fu">getMask</span><span class="op">(</span> <span class="fu">rids</span><span class="op">(</span> <span class="fl">4</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="fu">rids</span><span class="op">(</span> <span class="fl">6</span> <span class="op">)</span>, <span class="fu">getMask</span><span class="op">(</span> <span class="fu">rids</span><span class="op">(</span> <span class="fl">6</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span> <span class="op">)</span>

<span class="va">slist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">plist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span> <span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span> <span class="va">ilist</span> <span class="op">)</span> <span class="op">)</span> <span class="op">{</span>
  <span class="va">temp</span> <span class="op">=</span> <span class="fu">thresholdImage</span><span class="op">(</span> <span class="va">ilist</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"Otsu"</span>, <span class="fl">3</span> <span class="op">)</span>
  <span class="va">temp</span> <span class="op">=</span> <span class="va">temp</span> <span class="op">*</span> <span class="op">(</span> <span class="va">ilist</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu">iMath</span><span class="op">(</span> <span class="va">ilist</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="st">"ME"</span>, <span class="fl">6</span> <span class="op">)</span> <span class="op">)</span>
  <span class="va">slist</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu">thresholdImage</span><span class="op">(</span> <span class="va">temp</span>, <span class="fl">2</span>, <span class="fl">2</span> <span class="op">)</span> <span class="op">*</span> <span class="va">upperhalf</span>
  <span class="va">plist</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ANTsRCore/man/getCentroids.html">getCentroids</a></span><span class="op">(</span> <span class="va">slist</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span> <span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span> <span class="va">ilist</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">slist</span><span class="op">[[</span><span class="va">k</span><span class="op">]</span><span class="op">]</span> <span class="op">)</span>
<span class="op">}</span>
<span class="co">#&gt; Warning in fun(libname, pkgname): couldn't connect to display "/private/tmp/</span>
<span class="co">#&gt; com.apple.launchd.IS5AozF7vT/org.xquartz:0"</span></code></pre></div>
<p><img src="surgeRygen_files/figure-html/setupX-1.png" width="700"><img src="surgeRygen_files/figure-html/setupX-2.png" width="700"><img src="surgeRygen_files/figure-html/setupX-3.png" width="700"><img src="surgeRygen_files/figure-html/setupX-4.png" width="700"><img src="surgeRygen_files/figure-html/setupX-5.png" width="700"></p>
<p>Here are definitions for some variables important for training: which images are for training and testing.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># identify the number of segmentation classes</span>
<span class="va">isTrain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">slist</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="cn">FALSE</span> <span class="op">)</span></code></pre></div>
<p>This example will do landmark learning.</p>
</div>
<div id="preparing-to-write-the-data-to-disk" class="section level2">
<h2 class="hasAnchor">
<a href="#preparing-to-write-the-data-to-disk" class="anchor"></a>Preparing to write the data to disk</h2>
<p>We will generate (in this case) 5 files. For each, we generate a random file unique ID and then create file extensions that map to the type of augmented data we will be generating. In this case, we will generate augmented images, the associated masks, the points, coord conv output and a heatmap. These all derive from the image lists we defined above. This stuff will be run on CPU separately from the training loop.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nFiles</span> <span class="op">=</span> <span class="fl">5</span>
<span class="kw">if</span> <span class="op">(</span> <span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/exists.html">exists</a></span><span class="op">(</span> <span class="st">"uid"</span> <span class="op">)</span> <span class="op">)</span>
  <span class="va">uid</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"LM"</span>,<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000000</span>,<span class="va">nFiles</span><span class="op">)</span>,<span class="st">"Z"</span><span class="op">)</span>
<span class="va">types</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Images.npy"</span>, <span class="st">"pointset.npy"</span>, <span class="st">"mask.npy"</span>, <span class="st">"coordconv.npy"</span>, <span class="st">"heatmap.npy"</span> <span class="op">)</span>
<span class="va">nmats</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">types</span><span class="op">)</span> <span class="co"># 5 arrays out</span>
<span class="va">trainTestFileNames</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="st">""</span>,nrow<span class="op">=</span><span class="va">nFiles</span>,ncol<span class="op">=</span><span class="va">nmats</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">colnamesTT</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"train"</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">".npy"</span>,<span class="st">""</span>,<span class="va">types</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"test"</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">".npy"</span>,<span class="st">""</span>,<span class="va">types</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span> <span class="va">trainTestFileNames</span> <span class="op">)</span> <span class="op">=</span> <span class="va">colnamesTT</span>
<span class="kw">for</span> <span class="op">(</span> <span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nFiles</span> <span class="op">)</span> <span class="op">{</span>
  <span class="va">twogroups</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"numpy/"</span>,<span class="va">uid</span><span class="op">[</span><span class="va">k</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"train"</span>,<span class="st">"test"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">npextsTr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span> <span class="va">twogroups</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">types</span> <span class="op">)</span>
  <span class="va">npextsTe</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span> <span class="va">twogroups</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">types</span> <span class="op">)</span>
  <span class="va">trainTestFileNames</span><span class="op">[</span><span class="va">k</span>,<span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">npextsTr</span>,<span class="va">npextsTe</span><span class="op">)</span> <span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span> <span class="va">trainTestFileNames</span>, <span class="st">"numpy/LMtrainttestfiles.csv"</span>, row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
<div id="augmenting-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#augmenting-the-data" class="anchor"></a>Augmenting the data</h2>
<p>We generate the data based on default parameters. If you want to learn more about the possibilities here, then please change the parameters and take a look at the results. We will show an example that looks at some parameter variations below.</p>
<p>The call below will write a test file to numpy. We just write one in this case as we keep it constant during training. Write as many as you want for your application</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">testfilename</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">trainTestFileNames</span><span class="op">[</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"test"</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">trainTestFileNames</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">gg</span> <span class="op">=</span> <span class="fu"><a href="../reference/generateDiskPointAndSegmentationData.html">generateDiskPointAndSegmentationData</a></span><span class="op">(</span>
    inputImageList <span class="op">=</span> <span class="va">ilist</span>,
    pointsetList <span class="op">=</span> <span class="va">plist</span>,
    selector <span class="op">=</span> <span class="op">!</span><span class="va">isTrain</span>,
    smoothHeatMaps <span class="op">=</span> <span class="fl">3.0</span>,
    maskIndex <span class="op">=</span> <span class="fl">2</span>,
    transformType <span class="op">=</span> <span class="st">"scaleShear"</span>,
    noiseParameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span>,
    sdSimulatedBiasField <span class="op">=</span> <span class="fl">0.01</span>,
    sdHistogramWarping <span class="op">=</span> <span class="fl">0.01</span>,
    sdAffine <span class="op">=</span> <span class="fl">0.1</span>, <span class="co"># limited</span>
    numpynames <span class="op">=</span> <span class="va">testfilename</span>,
    numberOfSimulations <span class="op">=</span> <span class="fl">8</span>
    <span class="op">)</span>
<span class="co"># visualize example augmented images</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span>,nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span> <span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span> <span class="op">)</span> <span class="op">{</span>
  <span class="va">temp</span> <span class="op">=</span> <span class="fu">as.antsImage</span><span class="op">(</span> <span class="va">gg</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">k</span>,,,<span class="fl">1</span><span class="op">]</span> <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span> <span class="va">temp</span> <span class="op">)</span>
  <span class="op">}</span></code></pre></div>
<p>We would typically run something like the code below in a continuous loop on a CPU thread separate from the GPU training loop. In practice, you may keep the parameters the same across train and test or set minimal augmentation parameters for test data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">while</span><span class="op">(</span> <span class="cn">TRUE</span> <span class="op">)</span> <span class="op">{</span>
  <span class="kw">for</span> <span class="op">(</span> <span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nFiles</span> <span class="op">)</span> <span class="op">{</span>
    <span class="va">trnfilename</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">trainTestFileNames</span><span class="op">[</span><span class="va">k</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"train"</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">trainTestFileNames</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">k</span>, <span class="va">trnfilename</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">)</span> <span class="op">)</span>
    <span class="va">gg</span> <span class="op">=</span> <span class="fu"><a href="../reference/generateDiskPointAndSegmentationData.html">generateDiskPointAndSegmentationData</a></span><span class="op">(</span>
        inputImageList <span class="op">=</span> <span class="va">ilist</span>,
        pointsetList <span class="op">=</span> <span class="va">plist</span>,
        selector <span class="op">=</span> <span class="va">isTrain</span>,
        smoothHeatMaps <span class="op">=</span> <span class="fl">3.0</span>,
        maskIndex <span class="op">=</span> <span class="fl">2</span>,
        transformType <span class="op">=</span> <span class="st">"scaleShear"</span>,
        noiseParameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span>,
        sdSimulatedBiasField <span class="op">=</span> <span class="fl">0.01</span>,
        sdHistogramWarping <span class="op">=</span> <span class="fl">0.01</span>,
        sdAffine <span class="op">=</span> <span class="fl">0.1</span>,
        numpynames <span class="op">=</span> <span class="va">trnfilename</span>,
        numberOfSimulations <span class="op">=</span> <span class="fl">64</span>
        <span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span></code></pre></div>
<p>Getting the above steps correct is very critical to successful training. This package currently hides some of that complexity for basic segmentation and landmark prediction. However, it is always possible to make mistakes if the training decisions are inconsistent with the underlying theory. A forthcoming publication will explain the theory associated with this package.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Brian B Avants, Nicholas J Tustison.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
